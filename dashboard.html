<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MyDuka POS | Dashboard</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">

  <style>
    body {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      background-color: #f8f9fa;
      margin: 0;
    }

    #app {
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }

    main {
      flex: 1;
    }

    .chart-card {
      background: #fff;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 5px 16px rgba(0, 0, 0, 0.08);
    }

    footer {
      background: #212529;
      color: #fff;
      text-align: center;
      padding: 12px 0;
    }

    .navbar .nav-link,
    .navbar-brand {
      color: white !important;
    }

    .navbar .nav-link.active {
      color: #0dcaf0 !important;
    }
  </style>
</head>

<body>
<div id="app">

<!-- NAVBAR -->
<nav class="navbar navbar-expand-lg navbar-dark bg-dark bg-opacity-75 shadow-sm fixed-top">
  <div class="container-fluid">
    <a class="navbar-brand fw-bold" href="index.html">MyDuka POS</a>

    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
      <ul class="navbar-nav">

        <li class="nav-item" v-if="isLoggedIn">
          <a class="nav-link" href="products.html">Products</a>
        </li>

        <li class="nav-item" v-if="isLoggedIn">
          <a class="nav-link" href="purchases.html">Purchases</a>
        </li>

        <li class="nav-item" v-if="isLoggedIn">
          <a class="nav-link" href="sales.html">Sales</a>
        </li>

        <li class="nav-item" v-if="isLoggedIn">
          <a class="nav-link active fw-semibold" href="dashboard.html">Dashboard</a>
        </li>

        <li class="nav-item" v-if="!isLoggedIn">
          <a class="nav-link" href="login.html">Login</a>
        </li>

        <li class="nav-item" v-if="!isLoggedIn">
          <a class="nav-link" href="register.html">Register</a>
        </li>

        <li class="nav-item" v-if="isLoggedIn">
          <a class="nav-link text-danger fw-semibold" href="#" @click.prevent="logoutUser">
            Logout
          </a>
        </li>

      </ul>
    </div>
  </div>
</nav>


<!-- PAGE CONTENT -->
<main class="container pt-5 mt-5">
  <div class="row justify-content-center">
    <div class="col-lg-10">

      <div class="chart-card">
        <h5 class="mb-4 fw-semibold text-center">
          Remaining Stock per Product
        </h5>

        <canvas id="myChart" height="120"></canvas>
      </div>

    </div>
  </div>
</main>


<!-- FOOTER -->
<footer>
  <p class="mb-0 small">&copy; 2025 MyDuka POS. All rights reserved.</p>
</footer>

</div> <!-- END VUE APP -->


<!-- SCRIPTS -->
<script src="https://cdn.jsdelivr.net/npm/vue@2.7.7/dist/vue.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>

<script>
let chartInstance = null;

new Vue({
  el: '#app',

  data: {
    labels: [],
    values: [],
    isLoggedIn: false
  },

  created() {
    const token = localStorage.getItem("token");
    this.isLoggedIn = !!token;

    if (!token) {
      alert("Please login first.");
      window.location.href = "login.html";
    }
  },

  methods: {

    async fetchDashboardData() {
      try {
        const token = localStorage.getItem("token");

        const response = await axios.get(
          "http://127.0.0.1:8000/dashboard/spp",
          {
            headers: {
              Authorization: "Bearer " + token
            }
          }
        );

        this.labels = response.data[0]["labels"];
        this.values = response.data[0]["data"];

        this.renderChart();

      } catch (error) {
        alert("Failed to load dashboard data");
      }
    },

    renderChart() {
      const ctx = document.getElementById('myChart');

      if (chartInstance) {
        chartInstance.destroy();
      }

      chartInstance = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: this.labels,
          datasets: [{
            label: 'Remaining Stock Quantity',
            data: this.values,
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          scales: {
            y: {
              beginAtZero: true
            }
          }
        }
      });
    },

    logoutUser() {
      localStorage.removeItem("token");
      this.isLoggedIn = false;
      window.location.href = "login.html";
    }

  },

  mounted() {
    if (this.isLoggedIn) {
      this.fetchDashboardData();
    }
  }

});
</script>

</body>
</html>
